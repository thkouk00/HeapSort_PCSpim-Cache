.data
	# A: .byte 6, 14, 2, 10, 3, 5, 1, 30, 8, 50, 0, -1, -5, 100
	A:	.byte 110, -77, -57, 67, -34, -34, 17, 119, -92, -57, 83, 21, 89, 11, 19, -118, -11, -4, 98, 126
		.byte -63, 88, 102, 115, 79, -60, 9, 97, -87, -112, -80, 101, 100, -122, 1, -14, -73, 87, 63, 97
		.byte 127, 52, -16, -127, 109, -26, 7, 118, 125, 97, -6, -75, -50, -110, 83, 36, 45, 39, -44, 85
		.byte 53, 50, -88, 117, -109, -101, -50, -34, -48, -60, -110, -92, 20, -32, -9, -38, 78, -127, 20, -94
		.byte 49, -39, -114, 69, -26, -57, -53, 77, 31, 20, 56, -23, -73, -14, 72, 30, 64, 87, -23, -116
		.byte -123, 11, 96, 58, 23, -66, -63, -110, -23, 7, -20, 9, 96, 105, -17, -46, 126, -41, -18, 26
		.byte -3, 90, -9, 34, 94, 116, 0, 94, 55, 113, -29, -128, -50, 83, 55, 18, -79, -119, -7, -118
		.byte -81, -93, -31, 25, -74, -14, 12, -53, 118, 53, -72, 0, 63, -57, -71, -100, -116, -53, 115, 121
		.byte -48, 70, 38, -103, -47, 8, 4, 6, -42, 80, -18, -24, -26, -68, -71, -111, 8, 18, 105, -27
		.byte 44, 123, -90, -38, -92, 85, -36, 57, -26, 91, -64, -71, -104, 37, 32, -93, 71, 4, -11, -123
		.byte 76, -66, -23, -66, 49, 81, 124, -82, 116, 124, -28, 102, 22, 38, -93, -21, 78, 18, 39, -99
		.byte -6, 73, -86, -102, -62, 55, 99, 97, 29, 121, -10, -10, -91, 46, 103, -30, 83, -75, -85, 61
		.byte 30, 8, 25, 35, 61, -15, -62, -59, 12, 85, -95, -80, -32, -83, -76, 86, 103, -9, 117, 15
		.byte -88, -93, 108, 1, -5, 106, -86, -67, -29, 75, -127, 58, 45, -55, -4, -84, 123, -60, 65, -15
		.byte 19, 53, 62, -48, 116, -87, 105, -80, 83, -123, 58, 5, 50, 31, -30, -53, 59, -62, 120, 54
		.byte 75, -39, -69, 39, -109, -92, 66, 31, -106, -49, 43, -80, 102, -29, -116, 78, 24, -46, 93, 118
		.byte -23, -14, -104, -47, 111, -57, 106, 0, -11, -15, 79, 118, -41, -36, 89, 28, 90, 24, 126, 7
		.byte -84, 119, -116, -39, -103, -68, -75, -15, -92, -43, 33, 66, 95, 81, -81, -13, 20, 16, 36, -26
		.byte -23, 124, 64, 37, -19, -118, 127, 11, 6, -117, 1, -68, -80, -124, 77, 42, -38, -86, 43, -77
		.byte 96, 124, 46, 66, -107, 20, 9, -89, -100, 13, 22, 121, -25, 3, -124, -115, 42, 123, -66, -57
		.byte 41, -14, 13, 57, -109, -123, -81, 74, -2, 102, -22, -7, 85, -35, -79, 7, -74, -113, 76, 92
		.byte 116, -103, 88, -110, 88, -106, 112, -44, 42, 121, 45, 2, 93, -9, 123, 54, 105, 74, 23, 39
		.byte 31, 111, 42, -123, -35, 91, -104, -88, -49, 47, -118, 108, -81, 25, -65, -26, -27, 105, 96, 5
		.byte -128, -86, -98, -39, -95, 35, -76, -23, 98, 45, -36, -48, -14, -51, -27, -51, -77, 86, 39, 1
		.byte -33, -58, -64, -124, -34, -26, -65, -51, -73, 40, -17, 13, -60, -24, 28, -57, 79, 98, -97, -11
		.byte 5, 23, -15, 17, -93, -84, 21, -7, -94, -14, 11, -47, -37, -78, -39, -67, -71, -55, 16, -42
		.byte 123, 29, 115, 126, -100, 52, 60, 115, -36, -51, -127, 12, -85, -111, 67, -121, -53, -39, 38, 17
		.byte 113, 84, -53, -32, 112, 74, -72, 45, 95, -44, -2, 41, 47, 26, 54, -103, 65, -51, -52, 111
		.byte 4, 51, 84, -46, 72, 43, 8, -23, 2, -53, 102, -29, -56, -19, -42, 2, -70, 101, -75, -35
		.byte 89, 119, -43, 27, -122, 75, -123, -37, -6, 7, -28, -44, -84, -98, -13, -121, -58, -78, 29, 115
		.byte 46, -35, -88, -102, -65, -81, 60, -109, 120, 81, -127, 57, -114, 72, 84, -54, -6, -84, 61, -57
		.byte 69, 119, 105, 55, 45, 43, 64, -31, -121, 59, 76, -83, -59, -36, -88, 14, -7, 68, -8, -106
		.byte 57, -119, 18, -28, -59, -34, 125, 71, -7, 83, 10, 119, 40, -75, 82, -52, 9, 105, 117, 121
		.byte 89, 40, -23, 12, -7, 80, 39, -76, 105, -10, 33, -84, 106, 58, -107, 39, 113, 73, -64, 102
		.byte -119, 1, -54, 77, 23, 124, -27, -80, 76, -60, 126, -22, 14, 89, -17, -50, 123, 91, 109, -76
		.byte -121, 57, -8, 32, 7, 119, 6, -42, 19, 83, -113, -77, -14, -6, -85, 47, 87, 48, -47, -105
		.byte 103, 101, -77, -4, 48, 54, 11, 85, 73, 92, 22, 49, 14, -54, 53, 60, 48, 16, 21, 29
		.byte 2, -101, 41, -117, 25, -23, 30, -32, -81, -87, -109, 5, 30, 67, -117, 37, 45, 109, 112, -117
		.byte 1, 44, -97, 42, 2, -98, 9, -96, -125, 83, 35, 48, 35, -33, 117, -124, 127, 90, 79, -79
		.byte 63, 63, -89, -113, -121, -9, 39, -50, 56, 71, 60, -25, -77, -19, -9, 79, -9, 10, 82, -53
		.byte 36, -118, -3, -14, -41, 64, 22, -75, -26, -26, 26, -25, -128, -117, 40, -39, -75, -94, 1, 105
		.byte -114, -32, 70, 104, -35, -64, -12, -46, 82, -116, -118, 93, 83, -35, -84, 14, -34, 79, -51, 97
		.byte -79, -46, -26, 113, 99, -120, -52, 38, -96, 45, 51, -64, -66, -75, -112, -60, -13, 25, -49, 29
		.byte -100, 92, -59, 35, -29, -14, 103, -33, -20, 63, 78, -5, -30, 65, -117, 9, -93, 103, 57, 101
		.byte 27, 23, -12, 105, -27, -37, 57, 122, 48, -35, 40, 3, 56, -11, 57, -75, -109, 101, 9, -69
		.byte -113, -94, -103, -127, -8, 54, 40, -43, -53, 83, -28, 20, -111, -64, -106, 33, -85, 57, -19, 59
		.byte 110, 13, 12, 92, -19, -119, 33, 35, 57, 20, 79, 36, 7, 25, -109, -111, 29, 11, 18, -32
		.byte -34, -98, 58, 67, 25, -127, 15, -8, -13, 3, 115, -23, 85, -127, 112, 88, 71, -1, 99, -24
		.byte 94, -95, -119, -63, 48, 125, -53, 88, 5, -108, -93, -84, 38, -47, 48, 0, -62, 115, 104, -92
		.byte 8, 76, -91, 66, 125, -79, -27, 27, 38, -83, 13, 49, -32, 118, 1, 68, 59, 59, -112, 38
.text
	.globl __start
__start:
	li $t1, 1000						# number of elements of A				
	# li $t1, 14
	li $t0, 0x10010000					# address of A
	div $s1, $t1, 2						# length/2
	mflo $s2							# take div as index

for:
	addi $s2, $s2, -1
	blt $s2, $zero, end


	jal left_child						# offset of left child
	jal right_child						# offset of right child

	jal swap
	j for
end:
	jal sort

done:
	li $v0,10							
	syscall

sort:
	add $t8, $t0, $t1					
	addi $t8, $t8, -1					# last element's position
	lb $s5, ($t8)						# take last element
	lb $t9, ($t0)						# take first element
	sb $s5, ($t0) 						# store last element as first 
	sb $t9, ($t8)						# store first element as last
	addi $t1, $t1, -1					# reduce array size
	beq $t1, $zero, done  
	#  -heapify-
	div $s1, $t1, 2						# length/2
	mflo $s2							# take div as index
	addi $s2, $s2, -1
	blt $s2, $zero, end

	jal left_child						# offset of left child
	jal right_child						# offset of right child
	jal swap
	j sort

swap:
	bge $t2, $t1, for					# if left child is out of bounds 

	add $s3, $t0, $s2					# address of A[i]
	lb $s4, ($s3)						# s4 = A[i] temp			
	
	add $t4, $t0, $t2					# address of A[i*2+1]
	lb $t5, ($t4)						# A[i*2+1], left child
	
	bge $t3, $t1, compare_left			# if right child is out of bounds

	add $t6, $t0, $t3					# address of A[i*2+2]
	lb $t7, ($t6)						# A[i*2+2], right child
	
	bgt $t5, $t7, compare_left			# left child > right child
	j compare_right						# left child <= right child

swap_ret_left:
	addiu $sp, $sp, -8
	sw $ra, ($sp)
	sw $s2, 4($sp)

	sub $s2, $t4, $t0
	jal heapify
	j for

swap_ret_right:
	addiu $sp, $sp, -8
	sw $ra, ($sp)
	sw $s2, 4($sp)

	sub $s2, $t6, $t0
	jal heapify
	j for


swap_left:
	sb $t5, ($s3)						# A[i] = A[i*2+1]
 	sb $s4, ($t4)						# A[i*2+1] = s4 where s4 is the A[i] 
	
 	j swap_ret_left

swap_right:
	sb $t7, ($s3)						# A[i] = A[i*2+2]
 	sb $s4, ($t6)						# A[i*2+2] = s4 where s4 is the A[i] 
 	j swap_ret_right

heapify:
	jal left_child
	jal right_child
	bge $t2, $t1, out_of_bounds			# if left child is out of bounds 

	add $s3, $t0, $s2					# address of A[i]
	lb $s4, ($s3)						# s4 = A[i] temp			
	
	add $t4, $t0, $t2					# address of A[i*2+1]
	lb $t5, ($t4)						# A[i*2+1], left child
	
	bge $t3, $t1, compare_left1			# if right child is out of bounds

	add $t6, $t0, $t3					# address of A[i*2+2]
	lb $t7, ($t6)						# A[i*2+2], right child
	
	bgt $t5, $t7, compare_left1			# left child < right child
	j compare_right1					# left child > right child

compare_left:
	bgt $t5, $s4, swap_left				# A[i*2+1] > A[i] 
	j for

compare_right:
	bgt $t7, $s4, swap_right			# A[i*2+2] > A[i] 
	j for

compare_left1:
	bgt $t5, $s4, swap_left				# A[i*2+1] > A[i] 
	j out_of_bounds

compare_right1:
	bgt $t7, $s4, swap_right			# A[i*2+2] > A[i] 
	j out_of_bounds

left_child:
	sll $t2, $s2, 1						# index * 2 
	addi $t2, $t2, 1					# left child index*2 + 1
	jr $ra

right_child:
	sll $t3, $s2, 1						# index * 2 
	addi $t3, $t3, 2					# left child index*2 + 2
	jr $ra

out_of_bounds:
	lw $ra, ($sp)
	lw $s2, 4($sp)
	addiu $sp, $sp, 8
	jr $ra

####################################### - put elements in order - #########################################################
swap2:
	bge $t2, $t1, sort					# if left child is out of bounds 

	add $s3, $t0, $s2					# address of A[i]
	lb $s4, ($s3)						# s4 = A[i] temp			
	
	add $t4, $t0, $t2					# address of A[i*2+1]
	lb $t5, ($t4)						# A[i*2+1], left child
	
	bge $t3, $t1, compare_left2			# if right child is out of bounds

	add $t6, $t0, $t3					# address of A[i*2+2]
	lb $t7, ($t6)						# A[i*2+2], right child
	
	bgt $t5, $t7, compare_left2			# left child > right child
	j compare_right2					# left child <= right child

swap_ret_left2:
	addiu $sp, $sp, -8
	sw $ra, ($sp)
	sw $s2, 4($sp)

	sub $s2, $t4, $t0
	jal heapify2
	j sort

swap_ret_right2:
	addiu $sp, $sp, -8
	sw $ra, ($sp)
	sw $s2, 4($sp)

	sub $s2, $t6, $t0
	jal heapify2
	j sort


swap_left2:
	sb $t5, ($s3)						# A[i] = A[i*2+1]
 	sb $s4, ($t4)						# A[i*2+1] = s4 where s4 is the A[i] 
	
 	j swap_ret_left2

swap_right2:
	sb $t7, ($s3)						# A[i] = A[i*2+2]
 	sb $s4, ($t6)						# A[i*2+2] = s4 where s4 is the A[i] 
 	j swap_ret_right2

heapify2:
	jal left_child
	jal right_child
	bge $t2, $t1, out_of_bounds			# if left child is out of bounds 

	add $s3, $t0, $s2					# address of A[i]
	lb $s4, ($s3)						# s4 = A[i] temp			
	
	add $t4, $t0, $t2					# address of A[i*2+1]
	lb $t5, ($t4)						# A[i*2+1], left child
	
	bge $t3, $t1, compare_left3			# if right child is out of bounds

	add $t6, $t0, $t3					# address of A[i*2+2]
	lb $t7, ($t6)						# A[i*2+2], right child
	
	bgt $t5, $t7, compare_left3			# left child > right child
	j compare_right3					# left child <= right child

compare_left2:
	bgt $t5, $s4, swap_left2			# A[i*2+1] > A[i] 
	j sort

compare_right2:
	bgt $t7, $s4, swap_right2			# A[i*2+2] > A[i] 
	j sort

compare_left3:
	bgt $t5, $s4, swap_left2			# A[i*2+1] > A[i] 
	j out_of_bounds

compare_right3:
	bgt $t7, $s4, swap_right2			# A[i*2+2] > A[i] 
	j out_of_bounds
